<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KRATORQ - Space Command Center</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <style>
    :root{
      --bg-starfield: url('Images/Background.jpg');
      --bg-nebula: url('Images/Background2.jpg');
      --hero-image: url('Images/Kratorz1.jpg');

      --color-primary: #0a0a0a;
      --color-white: #ffffff;
      --color-flame: #ff4500;
      --color-flame-bright: #ff6b00;
      --color-flame-overlay: rgba(255,69,0,0.15);

      --font-primary: 'Orbitron','Exo 2','Rajdhani',monospace;
      --font-secondary: 'Exo 2','Rajdhani',sans-serif;

      --robot-size: min(600px, 90vw);
      --title-size: clamp(3rem, 10vw, 5rem);
      --subtitle-size: clamp(1rem, 3.5vw, 1.4rem);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:var(--font-primary);
      background: var(--color-primary);
      overflow-x:hidden;
      min-height:100vh;
      position:relative;
      color:var(--color-white);
      background-image: var(--bg-starfield);
      background-size:cover;
      background-position:center center;
    }

    .bg-layer{ position:fixed; inset:0; width:100%; height:100%; background-size:cover; background-position:center; background-repeat:no-repeat }
    .bg-starfield{ background-image:var(--bg-starfield); z-index:0; filter:brightness(0.7) contrast(1.2) }
    .bg-nebula{ background-image:var(--bg-nebula); z-index:1; opacity:0.4; mix-blend-mode:screen }

    .flame-overlay{
      position:fixed; inset:0; z-index:3; pointer-events:none;
      background: radial-gradient(ellipse at center bottom, var(--color-flame-overlay) 0%, transparent 60%);
      animation: flame-pulse 4s ease-in-out infinite;
    }
    @keyframes flame-pulse{ 0%,100%{opacity:.3;transform:scale(1)}50%{opacity:.6;transform:scale(1.05)} }

    .ember-container{ position:fixed; left:0; bottom:0; width:100%; height:100%; z-index:4; pointer-events:none; overflow:hidden }
    .ember{ position:absolute; width:3px; height:8px; background:linear-gradient(to top,var(--color-flame),var(--color-flame-bright)); border-radius:50%; box-shadow:0 0 10px var(--color-flame); animation: ember-rise 6s ease-out infinite; opacity:0 }
    @keyframes ember-rise { 0%{transform:translateY(0);opacity:0} 10%{opacity:1} 90%{opacity:.8} 100%{transform:translateY(-100vh) translateX(calc(var(--drift)*50px));opacity:0} }

    .main-container{
      position:relative; z-index:10; min-height:100vh; display:flex; align-items:center; justify-content:center; gap:4rem;
      padding:2rem; perspective:2000px;
    }

    /* SHIFT THE MODEL SLIGHTLY LEFT by default (tweak in CSS or the JS SHIFT_EXTRA). */
    .robot-section{
      display:flex; flex-direction:column; align-items:center; gap:2rem; flex:0 0 auto;
      transform: translateX(-6vw); transition: transform .45s cubic-bezier(.2,.9,.2,1);
    }

    .robot-wrap{ width:var(--robot-size); height:var(--robot-size); display:flex; align-items:center; justify-content:center; position:relative; z-index:12; transition:transform .3s ease; filter: drop-shadow(0 0 40px rgba(0,255,255,.3)); animation:robot-float 4s ease-in-out infinite }
    @keyframes robot-float{ 0%,100%{transform:translateY(0) rotate(0)} 25%{transform:translateY(-20px) rotate(2deg)} 50%{transform:translateY(-10px) rotate(-2deg)} 75%{transform:translateY(-25px) rotate(1deg)} }
    .robot-wrap:hover{ animation-play-state:paused; transform:scale(1.05); filter: drop-shadow(0 0 60px rgba(0,255,255,.5)) }

    .hero-3d{ width:100%; height:100%; background:transparent; overflow:visible; animation:glow-pulse-3d 3s ease-in-out infinite }
    @keyframes glow-pulse-3d{ 0%,100%{filter:drop-shadow(0 0 40px rgba(0,255,255,.2))} 50%{filter:drop-shadow(0 0 60px rgba(0,255,255,.4))} }
    .hero-3d iframe, .hero-3d spline-viewer{ width:100% !important; height:100% !important; border:none; background:transparent }

    .activate-button{
      padding:1.5rem 4rem; background:linear-gradient(135deg,var(--color-flame),var(--color-flame-bright));
      color:var(--color-white); font-family:var(--font-primary); font-weight:900; font-size:1.8rem; letter-spacing:.2em;
      border:4px solid var(--color-flame-bright); border-radius:3rem; cursor:pointer; box-shadow:0 0 60px rgba(255,69,0,.8),0 20px 40px rgba(0,0,0,.6);
      animation:activate-pulse 2s ease-in-out infinite; transition:all .3s ease; text-transform:uppercase; position:relative; z-index:13;
    }
    .activate-button.hidden{ opacity:0; visibility:hidden; pointer-events:none }
    @keyframes activate-pulse{ 0%,100%{transform:scale(1)}50%{transform:scale(1.05)} }
    .activate-button:hover{ transform:scale(1.1) }

    .hero-card{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); opacity:0; visibility:hidden; display:flex; flex-direction:column; align-items:center; z-index:11 }

    .hero-image-container{ position:relative; filter:drop-shadow(0 10px 40px rgba(255,69,0,.5)); margin-bottom:2rem }
    .hero-image{ display:block; max-width:min(800px,85vw); max-height:80vh; width:auto; height:auto; border-radius:1.5rem; border:6px solid var(--color-flame); box-shadow:0 0 50px var(--color-flame); transition:all .4s ease; position:relative; z-index:2; object-fit:contain }
    .hero-image-container:hover .hero-image{ transform:scale(1.05); box-shadow:0 0 80px var(--color-flame-bright) }

    .hero-content{text-align:center;width:100%}
    .hero-title{ font-size:var(--title-size); font-weight:900; color:var(--color-flame-bright); text-shadow:0 0 30px var(--color-flame); margin-bottom:1.5rem; letter-spacing:.25em; animation:flame-glow-pulse 3s ease-in-out infinite }
    .hero-subtitle{ font-size:var(--subtitle-size); font-family:var(--font-secondary); font-weight:400; color:var(--color-white); margin-bottom:3rem; letter-spacing:.35em; text-shadow:0 2px 10px rgba(0,0,0,.5) }

    @keyframes flame-glow-pulse{ 0%,100%{text-shadow:0 0 30px var(--color-flame)} 50%{text-shadow:0 0 50px var(--color-flame-bright)} }

    /* engage as an anchor (works without JS), styled like a button */
    .engage-button{
      display:inline-block; padding:1.2rem 3.5rem; background:linear-gradient(135deg,var(--color-flame),var(--color-flame-bright));
      color:var(--color-white); font-family:var(--font-primary); font-weight:700; font-size:1.3rem; border-radius:2.5rem; text-decoration:none;
      box-shadow:0 0 40px rgba(255,69,0,.6),0 15px 30px rgba(0,0,0,.4); transition:all .3s ease; letter-spacing:.15em; position:relative; overflow:hidden;
    }
    .engage-button:focus{ outline:3px solid var(--color-flame); outline-offset:5px }
    .engage-button::after{ content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:linear-gradient(45deg,transparent, rgba(255,255,255,.3), transparent); transform:rotate(45deg); animation:shine 3s infinite }
    @keyframes shine{ 0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)} 100%{transform:translateX(100%) translateY(100%) rotate(45deg)} }
    .engage-button:active::before{ width:400px; height:400px }

    .flame-particle{ position:absolute; width:8px; height:8px; background:var(--color-flame); border-radius:50%; pointer-events:none; z-index:1000; box-shadow:0 0 20px var(--color-flame) }
    .impact-crater{ position:absolute; border-radius:1.5rem; border:3px solid var(--color-flame); opacity:0; pointer-events:none; z-index:999; box-shadow:0 0 40px var(--color-flame) }

    /* Responsive safety: remove CSS left-shift on tablet/smaller so model won't clip */
    @media (max-width:1024px){
      .main-container{ flex-direction:column; gap:2rem }
      .hero-card{ position:relative; left:auto; top:auto; transform:none }
      :root{ --robot-size: min(500px,85vw) }
      /* don't keep the initial translate on medium/smaller screens */
      .robot-section{ transform:none !important }
      .hero-image{ max-width:min(600px,85vw) }
    }

    @media (max-width:768px){
      :root{ --robot-size: min(400px,80vw) }
      .hero-image{ max-width:min(500px,80vw); max-height:70vh }
      .engage-button{ padding:1rem 3rem; font-size:1.2rem }
      .activate-button{ padding:1.2rem 3rem; font-size:1.4rem }
    }

    @media (max-width:480px){
      .main-container{ padding:1rem }
      .engage-button{ padding:.9rem 2.5rem; font-size:1.1rem }
      .activate-button{ padding:1rem 2rem; font-size:1.2rem }
      .hero-image{ max-width:min(400px,75vw); max-height:65vh }
    }

    @media (prefers-reduced-motion: reduce) {
      * { animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition-duration:0.01ms !important; }
    }
  </style>
</head>
<body>
  <div class="bg-layer bg-starfield" id="starfield"></div>
  <div class="bg-layer bg-nebula" id="nebula"></div>
  <div class="flame-overlay"></div>
  <div class="ember-container" id="emberContainer"></div>

  <main class="main-container">
    <!-- Robot Section (initially nudged left via CSS) -->
    <div class="robot-section" id="robotSection">
      <div class="robot-wrap" id="robotWrap">
        <div class="hero-3d" id="splineContainer">
          <spline-viewer url="https://prod.spline.design/LQGAbUrnRnBAAz-B/scene.splinecode" aria-label="3D robot model" role="img"></spline-viewer>
        </div>
      </div>

      <button class="activate-button" id="activateButton">ðŸ”¥ ACTIVATE ðŸ”¥</button>
    </div>

    <!-- Card: Image with text below (will drop into center) -->
    <section class="hero-card" id="heroCard">
      <div class="hero-image-container" id="heroImageContainer">
        <img src="Images/Kratorz2.jpg" alt="KRATORQ Event Poster" class="hero-image" id="heroImage">
      </div>

      <div class="hero-content">
        <h1 class="hero-title">KRATORQ</h1>
        <p class="hero-subtitle">EVENT Â· ENGAGE Â· LAUNCH</p>

        <!-- Use anchor so navigation works without JS; JS handler forces immediate navigation -->
        <a href="event.html" class="engage-button" id="engageButton" role="button" tabindex="0" aria-label="Navigate to event page">ENGAGE</a>
      </div>
    </section>
  </main>

  <!-- Spline viewer -->
  <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.80/build/spline-viewer.js"></script>

  <script type="module">
    gsap.registerPlugin(ScrollTrigger);
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    let hasActivated = false;

    // Tweak this if you want the final extra left-shift after the image lands.
    // 0.28 = 28% of window width to the left (increase to move further left).
    const SHIFT_EXTRA = 0.28;

    function initContinuousRobotAnimations(){
      if(prefersReducedMotion) return;
      const robotWrap = document.getElementById('robotWrap');
      const hero3d = document.querySelector('.hero-3d');

      function randomMovement(){
        const tl = gsap.timeline({ repeat:-1, repeatDelay: Math.random()*2 });
        tl.to(hero3d, {
          rotationX: () => gsap.utils.random(-5,5),
          rotationY: () => gsap.utils.random(-5,5),
          scale: () => gsap.utils.random(0.98,1.02),
          duration: () => gsap.utils.random(2,4),
          ease: "sine.inOut"
        }).to(hero3d, { rotationX:0, rotationY:0, scale:1, duration: () => gsap.utils.random(2,4), ease: "sine.inOut" });
      }

      randomMovement();

      gsap.to(hero3d, { scale:1.02, duration:2, ease:"sine.inOut", yoyo:true, repeat:-1 });
      gsap.to(robotWrap, { filter: 'drop-shadow(0 0 60px rgba(0, 255, 255, 0.5))', duration:3, ease:"sine.inOut", yoyo:true, repeat:-1 });
    }

    function createEmberParticles(){
      const container = document.getElementById('emberContainer');
      const numEmbers = window.innerWidth < 768 ? 20 : 40;
      for(let i=0;i<numEmbers;i++){
        const ember = document.createElement('div');
        ember.className = 'ember';
        ember.style.left = Math.random()*100 + '%';
        ember.style.bottom = '-10px';
        ember.style.animationDelay = Math.random()*6 + 's';
        ember.style.animationDuration = (4 + Math.random()*4) + 's';
        ember.style.setProperty('--drift', (Math.random()-0.5)*2);
        container.appendChild(ember);
      }
    }

    function createFlameExplosion(x,y){
      if(prefersReducedMotion) return;
      const numParticles = 80;
      const colors = ['var(--color-flame)','var(--color-flame-bright)', '#ffaa00', '#ff0000'];

      for(let i=0;i<5;i++){
        const crater = document.createElement('div');
        crater.className = 'impact-crater';
        crater.style.left = x + 'px';
        crater.style.top  = y + 'px';
        document.body.appendChild(crater);
        gsap.fromTo(crater, { width:10, height:10, x:-5, y:-5, opacity:1 }, {
          width: 400 + (i*150),
          height: 500 + (i*180),
          x: -(200 + (i*75)),
          y: -(250 + (i*90)),
          opacity: 0,
          duration: 2,
          delay: i*0.05,
          ease:"power2.out",
          onComplete: () => crater.remove()
        });
      }

      for(let i=0;i<numParticles;i++){
        const particle = document.createElement('div');
        particle.className = 'flame-particle';
        particle.style.background = colors[Math.floor(Math.random()*colors.length)];
        document.body.appendChild(particle);

        const angle = (Math.PI*2*i)/numParticles;
        const velocity = 150 + Math.random()*200;
        const vx = Math.cos(angle)*velocity;
        const vy = Math.sin(angle)*velocity - 100;

        gsap.set(particle, { x, y });
        gsap.to(particle, {
          x: x + vx,
          y: y + vy,
          scale: gsap.utils.random(0,3),
          rotation: Math.random()*720,
          opacity: 0,
          duration: gsap.utils.random(1.5,3),
          ease: "power2.out",
          onComplete: () => particle.remove()
        });
      }

      const flash = document.createElement('div');
      flash.style.cssText = `
        position:fixed; inset:0;
        background: radial-gradient(circle at ${x}px ${y}px,
          rgba(255,69,0,0.7),
          rgba(255,140,0,0.4) 30%,
          transparent 60%);
        pointer-events:none; z-index:9999;
      `;
      document.body.appendChild(flash);
      gsap.to(flash, { opacity:0, duration:1.2, ease:"power2.out", onComplete: ()=> flash.remove() });
    }

    function triggerActivation(){
      if(hasActivated || prefersReducedMotion) return;
      hasActivated = true;

      const activateButton = document.getElementById('activateButton');
      const robotWrap = document.getElementById('robotWrap');
      const robotSection = document.getElementById('robotSection');
      const heroCard = document.getElementById('heroCard');

      const masterTL = gsap.timeline();

      // hide button
      masterTL.to(activateButton, { scale:0, opacity:0, duration:0.4, ease:"back.in(2)", onComplete: ()=> activateButton.classList.add('hidden') })

      // robot celebrates
      .to(robotWrap, { scale:1.4, y:-50, rotation:20, duration:0.6, ease:"power2.out" })
      .to(robotWrap, { rotation:-20, duration:0.25, ease:"sine.inOut", yoyo:true, repeat:2 })

      // move robot section left (initial move)
      .to(robotSection, { x: -window.innerWidth * 0.2, duration:1.5, ease:"power3.inOut" })
      .to(robotWrap, { scale:0.75, rotation:0, y:0, duration:1.5, ease:"power3.inOut" }, "<")

      // Drop the card into perfect center
      .set(heroCard, { opacity:1, visibility:'visible', y:'-120vh', rotationZ:-180, scale:0.3 })
      .to(heroCard, {
        y: 0, rotationZ: 0, scale: 1, duration: 1.8, ease:"power2.out",
        onComplete: function(){
          const rect = heroCard.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.bottom;
          createFlameExplosion(x, y);

          // subtle bounce
          gsap.timeline()
            .to(heroCard, { top: 'calc(50% - 40px)', duration:0.25, ease:"power2.out" })
            .to(heroCard, { top: '50%', duration:0.4, ease:"bounce.out" });

          // >>> AFTER THE IMAGE HAS LANDED: nudge the model a bit more to the left.
          // This pushes the robot further left for a more cinematic composition.
          // It respects the responsive override (mobile/tablet won't apply this because .robot-section transform is reset there).
          gsap.to(robotSection, { x: -window.innerWidth * SHIFT_EXTRA, duration: 0.9, ease: "power3.out", delay: 0.12 });
        }
      }, "+=0.3");
    }

    // Engagement anchor handler â€” guarantees navigation even if other handlers try to prevent
    function initEngageButton(){
      const engageButton = document.getElementById('engageButton');
      engageButton.addEventListener('click', (e) => {
        e.preventDefault();
        // hard navigate right away (no timeout)
        window.location.href = 'event.html';
      });
      engageButton.addEventListener('keydown', (e) => {
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          window.location.href = 'event.html';
        }
      });
    }

    function initActivationButton(){
      const activateButton = document.getElementById('activateButton');
      activateButton.addEventListener('click', triggerActivation);
    }

    // initialize
    document.addEventListener('DOMContentLoaded', () => {
      createEmberParticles();
      initEngageButton();
      initContinuousRobotAnimations();
      initActivationButton();
    });
  </script>
</body>
</html>
